{% set path = "static/sections/news/" ~ lang ~ ".toml" %}
{% set data = load_data(path=path, required=false) %}

{% if data %}
<section id="news" class="section news-section">
    <div class="container">
        <div class="row text-center">
            <div class="col-lg-6 offset-lg-3">
                <div class="news-section__header">
                    <h1>{{ data.title }}</h1>
                    {% if data.subtitle %}<p>{{ data.subtitle }}</p>{% endif %}
                </div>
            </div>
        </div>

        <div class="news-slider-container" style="position: relative; padding: 0 50px;">
            <div id="newsCarousel" class="carousel slide" data-bs-ride="false">
                <div class="carousel-inner" style="padding-bottom: 20px;">
                    <div class="carousel-item active">
                        <div class="row">
                            {% for item in data.items %}
                            {% if loop.index0 > 0 and loop.index0 % 3 == 0 %}
                        </div>
                    </div>
                    <div class="carousel-item">
                        <div class="row">
                            {% endif %}

                            <div class="col-lg-4 col-md-6 mb-4">
                                <div class="news-card" style="height: 100%; display: flex; flex-direction: column;">
                                    <div class="news-card__image">
                                        <img src="{{ get_url(path=item.image) }}" alt="{{ item.title }}">
                                    </div>
                                    <div class="news-card__body"
                                        style="flex: 1; display: flex; flex-direction: column;">
                                        {% if item.top_title %}<span class="news-card__top-title"
                                            style="display:block; text-transform:uppercase; font-size:13px; color:#5d78ff; font-weight:700; margin-bottom:5px;">{{
                                            item.top_title }}</span>{% endif %}
                                        <span class="news-card__date">{{ item.date }}</span>
                                        <h5 class="news-card__title">{{ item.title }}</h5>
                                        <p class="news-card__text" style="flex: 1;">{{ item.description }}</p>

                                        {% if item.details %}
                                        <div>
                                            <a href="#" class="btn btn-sm btn-outline-primary mt-3"
                                                data-bs-toggle="modal" data-bs-target="#newsModal{{ loop.index }}">See
                                                Details</a>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <!-- Controls -->
                {% if data.items | length > 3 %}
                <button class="carousel-control-prev" type="button" data-bs-target="#newsCarousel" data-bs-slide="prev"
                    style="width: 50px; left: -50px; justify-content: center; align-items: center;">
                    <span class="carousel-control-prev-icon" aria-hidden="true"
                        style="filter: invert(50%) sepia(85%) saturate(3000%) hue-rotate(210deg) brightness(100%) contrast(100%); width: 3rem; height: 3rem;"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#newsCarousel" data-bs-slide="next"
                    style="width: 50px; right: -50px; justify-content: center; align-items: center;">
                    <span class="carousel-control-next-icon" aria-hidden="true"
                        style="filter: invert(50%) sepia(85%) saturate(3000%) hue-rotate(210deg) brightness(100%) contrast(100%); width: 3rem; height: 3rem;"></span>
                    <span class="visually-hidden">Next</span>
                </button>
                {% endif %}
            </div>
        </div>

        <!-- Modals -->
        {% for item in data.items %}
        {% if item.details %}
        <div class="modal fade" id="newsModal{{ loop.index }}" tabindex="-1"
            aria-labelledby="newsModalLabel{{ loop.index }}" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="newsModalLabel{{ loop.index }}"
                            style="font-family: inherit; margin: 0;">{{ item.title }}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body text-start" style="padding: 30px;">
                        <span style="color: #6a82fb; font-weight: 600; display: block; margin-bottom: 20px;">{{
                            item.date }}</span>
                        <div class="details-content" style="color: #444; line-height: 1.7; font-size: 15px;">
                            {{ item.details | markdown | safe }}
                        </div>

                        {% if item.extra_images %}
                        <div class="row mt-4">
                            {% for img in item.extra_images %}
                            <div class="col-md-4 mb-3">
                                <img src="{{ get_url(path=img) }}" class="img-fluid rounded shadow-sm"
                                    alt="Extra News Image" style="width: 100%; height: 150px; object-fit: cover;">
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        {% endfor %}
    </div>
</section>
{% endif %}