{% set path = "static/sections/news/" ~ lang ~ ".toml" %}
{% set data = load_data(path=path, required=false) %}

{% if data %}
<!-- Heartbeat Waveform Animation -->
<div class="heartbeat-container"
    style="width: 100%; overflow: hidden; height: 100px; position: relative; background: transparent; margin-bottom: 20px;">
    <svg width="200%" height="100%" viewBox="0 0 1000 100" preserveAspectRatio="none"
        style="position: absolute; top: 0; left: 0; animation: wave-move 5s linear infinite;">
        <defs>
            <linearGradient id="wave-grad" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" stop-color="#ff4b2b" />
                <stop offset="25%" stop-color="#38bdf8" />
                <stop offset="50%" stop-color="#ff4b2b" />
                <stop offset="75%" stop-color="#38bdf8" />
                <stop offset="100%" stop-color="#ff4b2b" />
            </linearGradient>
            <style>
                @keyframes wave-move {
                    0% {
                        transform: translateX(0);
                    }

                    100% {
                        transform: translateX(-50%);
                    }
                }
            </style>
        </defs>

        <!-- Solid area beneath the wave -->
        <path d="
            M 0 50 
            Q 25 20 50 50 T 100 50
            Q 125 20 150 50 T 200 50
            L 220 50 L 235 20 L 250 80 L 265 10 L 280 50 L 300 50
            Q 325 20 350 50 T 400 50
            Q 425 20 450 50 T 500 50
            
            Q 525 20 550 50 T 600 50
            Q 625 20 650 50 T 700 50
            L 720 50 L 735 20 L 750 80 L 765 10 L 780 50 L 800 50
            Q 825 20 850 50 T 900 50
            Q 925 20 950 50 T 1000 50
            L 1000 100 L 0 100 Z
        " fill="url(#wave-grad)" opacity="0.15" />

        <!-- Highlight wave line -->
        <path d="
            M 0 50 
            Q 25 20 50 50 T 100 50
            Q 125 20 150 50 T 200 50
            L 220 50 L 235 20 L 250 80 L 265 10 L 280 50 L 300 50
            Q 325 20 350 50 T 400 50
            Q 425 20 450 50 T 500 50
            
            Q 525 20 550 50 T 600 50
            Q 625 20 650 50 T 700 50
            L 720 50 L 735 20 L 750 80 L 765 10 L 780 50 L 800 50
            Q 825 20 850 50 T 900 50
            Q 925 20 950 50 T 1000 50
        " fill="none" stroke="url(#wave-grad)" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" />

    </svg>
</div>

<section id="news" class="section news-section">
    <div class="container">
        <div class="row text-center">
            <div class="col-lg-6 offset-lg-3">
                <div class="news-section__header">
                    <h1>{{ data.title }}</h1>
                    {% if data.subtitle %}<p>{{ data.subtitle }}</p>{% endif %}
                </div>
            </div>
        </div>

        <div class="news-slider-container" style="position: relative; padding: 0 50px;">
            <div id="newsCarousel" class="carousel slide" data-bs-ride="false">
                <div class="carousel-inner" style="padding-bottom: 20px;">
                    <div class="carousel-item active">
                        <div class="row">
                            {% for item in data.items %}
                            {% if loop.index0 > 0 and loop.index0 % 3 == 0 %}
                        </div>
                    </div>
                    <div class="carousel-item">
                        <div class="row">
                            {% endif %}

                            <div class="col-lg-4 col-md-6 mb-4">
                                <div class="news-card" style="height: 100%; display: flex; flex-direction: column;">
                                    <div class="news-card__image">
                                        <img src="{{ get_url(path=item.image) }}" alt="{{ item.title }}">
                                    </div>
                                    <div class="news-card__body"
                                        style="flex: 1; display: flex; flex-direction: column;">
                                        {% if item.top_title %}<span class="news-card__top-title"
                                            style="display:block; text-transform:uppercase; font-size:13px; color:#5d78ff; font-weight:700; margin-bottom:5px;">{{
                                            item.top_title }}</span>{% endif %}
                                        <span class="news-card__date">{{ item.date }}</span>
                                        <h5 class="news-card__title">{{ item.title }}</h5>
                                        <p class="news-card__text" style="flex: 1;">{{ item.description }}</p>

                                        {% if item.details %}
                                        <div>
                                            <a href="#" class="btn btn-sm btn-outline-primary mt-3"
                                                data-bs-toggle="modal" data-bs-target="#newsModal{{ loop.index }}">See
                                                Details</a>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <!-- Controls -->
                {% if data.items | length > 3 %}
                <button class="carousel-control-prev" type="button" data-bs-target="#newsCarousel" data-bs-slide="prev"
                    style="width: 50px; left: -50px; justify-content: center; align-items: center;">
                    <span class="carousel-control-prev-icon" aria-hidden="true"
                        style="filter: invert(50%) sepia(85%) saturate(3000%) hue-rotate(210deg) brightness(100%) contrast(100%); width: 3rem; height: 3rem;"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#newsCarousel" data-bs-slide="next"
                    style="width: 50px; right: -50px; justify-content: center; align-items: center;">
                    <span class="carousel-control-next-icon" aria-hidden="true"
                        style="filter: invert(50%) sepia(85%) saturate(3000%) hue-rotate(210deg) brightness(100%) contrast(100%); width: 3rem; height: 3rem;"></span>
                    <span class="visually-hidden">Next</span>
                </button>
                {% endif %}
            </div>
        </div>

        <!-- Modals -->
        {% for item in data.items %}
        {% if item.details %}
        <div class="modal fade" id="newsModal{{ loop.index }}" tabindex="-1"
            aria-labelledby="newsModalLabel{{ loop.index }}" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="newsModalLabel{{ loop.index }}"
                            style="font-family: inherit; margin: 0;">{{ item.title }}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body text-start" style="padding: 30px;">
                        <span style="color: #6a82fb; font-weight: 600; display: block; margin-bottom: 20px;">{{
                            item.date }}</span>
                        <div class="details-content" style="color: #444; line-height: 1.7; font-size: 15px;">
                            {{ item.details | markdown | safe }}
                        </div>

                        {% if item.extra_images %}
                        <div class="row mt-4">
                            {% for img in item.extra_images %}
                            <div class="col-md-4 mb-3">
                                <img src="{{ get_url(path=img) }}" class="img-fluid rounded shadow-sm"
                                    alt="Extra News Image" style="width: 100%; height: 150px; object-fit: cover;">
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        {% endfor %}
    </div>
</section>
{% endif %}